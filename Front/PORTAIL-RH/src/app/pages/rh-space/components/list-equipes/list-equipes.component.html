<div class="collab-home">
  <app-header></app-header>

  <div class="main-content">
    <app-sidebar></app-sidebar>

    <div class="feed">
      <div class="container">
        <h2 class="title">Liste Equipes</h2>

        <div class="history-header">
          <input
            class="search"
            type="text"
            placeholder="Rechercher une Equipe..."
            [(ngModel)]="searchText"
            (ngModelChange)="filterEquipes()"
          />
          <button class="add-button" (click)="toggleAddForm()">
            <mat-icon>add</mat-icon>
          </button>
        </div>

        <!-- Grid des équipes -->
        <div class="teams-grid" *ngIf="filteredEquipes.length > 0">
          <div class="team-card" *ngFor="let equipe of filteredEquipes">
            <div class="actions-menu">
              <button class="menu-button" (click)="toggleDropdown(equipe)">
                <mat-icon class="icon">more_vert</mat-icon>
              </button>
              <div class="dropdown-menu" *ngIf="equipe.showDropdown">
                <div class="dropdown-item" (click)="viewDetails(equipe.id)">
                  <mat-icon>visibility</mat-icon>
                  <span>Détails</span>
                </div>
                <div class="dropdown-item" (click)="editEquipe(equipe)">
                  <mat-icon>edit</mat-icon>
                  <span>Modifier</span>
                </div>
                <div class="dropdown-item" (click)="deleteEquipe(equipe.id)">
                  <mat-icon>delete</mat-icon>
                  <span>Supprimer</span>
                </div>
              </div>
            </div>

            <h3 class="team-name">{{ equipe.nom }}</h3>
            <div class="team-department">{{ equipe.departement }}</div>

            <div class="manager-info">
              <img
                [src]="equipe.manager?.image || 'assets/icons/user-login-icon-14.png'"
                alt="Manager Photo"
                class="manager-photo"
              />
              <div class="manager-details">
                <div class="manager-name">
                  {{ equipe.manager ? equipe.manager.prenom + ' ' + equipe.manager.nom : 'Aucun manager' }}
                </div>
                <div class="manager-role">Manager</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Empty state when no teams -->
        <div class="empty-state" *ngIf="filteredEquipes.length === 0">
          <mat-icon class="empty-icon">group_off</mat-icon>
          <p>Aucune équipe trouvée</p>
          <button class="btn btn-primary" (click)="toggleAddForm()">Créer une équipe</button>
        </div>

        <!-- Formulaire d'ajout -->
        <app-add-team-form
          *ngIf="showAddForm"
          [newEquipe]="newEquipe"
          [activeUsers]="activeUsers"
          [filteredActiveUsers]="filteredActiveUsers"
          [managerSearchText]="managerSearchText"
          (close)="toggleAddForm()"
          (create)="createEquipe()"
          (managerSearch)="filterManagers($event)"
          (managerSelect)="selectManager($event)"
        ></app-add-team-form>

        <!-- Formulaire de modification -->
        <div class="form-container" *ngIf="showEditForm">
          <div class="form-modal">
            <h3>Modifier une équipe</h3>
            <form>
              <div class="form-group">
                <label for="edit-nom">Nom de l'équipe</label>
                <input id="edit-nom" type="text" [(ngModel)]="editEquipeData.nom" name="edit-nom" placeholder="Nom" required />
              </div>

              <div class="form-group">
                <label for="edit-departement">Département</label>
                <input id="edit-departement" type="text" [(ngModel)]="editEquipeData.departement" name="edit-departement" placeholder="Département" required />
              </div>

              <div class="form-actions">
                <button type="button" class="btn btn-cancel" (click)="toggleEditForm()">Annuler</button>
                <button type="button" class="btn btn-submit" (click)="updateEquipe()">Enregistrer</button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>

    <app-right-sidebar></app-right-sidebar>
  </div>
</div>