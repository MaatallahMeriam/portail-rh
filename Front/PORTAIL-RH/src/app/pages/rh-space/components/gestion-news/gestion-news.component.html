<div class="collab-home">
  <app-header></app-header>

  <div class="main-content">
    <app-sidebar></app-sidebar>

    <div class="feed">
      <div class="container">
        <h2 class="titre">Affichage :</h2>

        <div class="slider-container">
          <owl-carousel-o [options]="customOptions">
            <ng-container *ngFor="let news of News">
              <ng-template carouselSlide>
                <div class="slide-content">
                  <img [src]="getImageUrl(news.imageUrl)" alt="News image" class="slide-img" />
                  <div class="image-description">
                    <h4 class="title">{{ news.titre }}</h4>
                    <p class="description">{{ news.description }}</p>
                  </div>
                </div>
              </ng-template>
            </ng-container>
          </owl-carousel-o>
        </div>

        <div class="history">
          <h3>Liste des News :</h3>
          <div class="history-header">
            <input
              class="search"
              type="text"
              placeholder="Rechercher une news..."
              [(ngModel)]="searchText"
              (ngModelChange)="filterNews()"
            />
            <button class="add-button" (click)="toggleForm()">+</button>
          </div>

          <div class="history-table-container">
            <ngx-datatable
              class="material"
              [rows]="filteredNews"
              [columns]="columns"
              [columnMode]="'force'"
              [headerHeight]="40"
              [footerHeight]="40"
              [rowHeight]="'auto'" 
              [scrollbarV]="false"
              [scrollbarH]="true"
              [sorts]="[{ prop: 'id', dir: 'asc' }]"
              [messages]="{
                emptyMessage: 'Aucune news trouvée',
                totalMessage: 'news au total'
              }"
            >
              <!-- Définir explicitement les colonnes -->
              <ngx-datatable-column prop="titre" name="Titre" [width]="200"></ngx-datatable-column>
              <ngx-datatable-column prop="description" name="Description" [width]="300"></ngx-datatable-column>
              <ngx-datatable-column prop="createdAt" name="Date Création" [width]="150"></ngx-datatable-column>
              <!-- Colonne pour les actions -->
              <ngx-datatable-column name="Actions" [sortable]="false" [width]="70">
                <ng-template let-row="row" ngx-datatable-cell-template>
                  <div class="actions-cell">
                    <button mat-icon-button (click)="toggleMenu(row); $event.stopPropagation()" class="menu-button">
                      <mat-icon>more_vert</mat-icon>
                    </button>
                    <div class="dropdown-menu" *ngIf="selectedNews === row">
                      <button mat-button (click)="supprimer(row)">
                        <mat-icon>delete</mat-icon>
                        Supprimer
                      </button>
                      <button mat-button (click)="modifier(row)">
                        <mat-icon>edit</mat-icon>
                        Modifier
                      </button>
                    </div>
                  </div>
                </ng-template>
              </ngx-datatable-column>
            </ngx-datatable>

            <!-- Formulaire pour ajouter/modifier une news -->
            <div *ngIf="showForm" class="form-container">
              <button class="close-button" (click)="toggleForm()">
                <mat-icon>close</mat-icon>
              </button>
              <h3>{{ isEditing ? 'Modifier Nouveautés' : 'Ajouter Nouveautés' }}</h3>
              <form class="content-form" (ngSubmit)="submitForm()">
                <div class="form-group">
                  <label for="titre">Titre :</label>
                  <input
                    id="titre"
                    type="text"
                    [(ngModel)]="titre"
                    name="titre"
                    placeholder="Titre"
                    required
                  />
                </div>

                <div class="form-group">
                  <label for="description">Description :</label>
                  <textarea
                    id="description"
                    [(ngModel)]="description"
                    name="description"
                    placeholder="Description"
                    required
                  ></textarea>
                </div>

                <div class="form-group">
                  <label for="doc-file">
                    {{ isEditing ? 'Modifier l\'image (optionnel) :' : 'Joindre une image :' }}
                  </label>
                  <input
                    id="doc-file"
                    type="file"
                    (change)="onFileChange($event)"
                    accept="image/*"
                    [required]="!isEditing"
                  />
                </div>

                <div class="form-actions">
                  <button type="submit" class="submit-button">
                    {{ isEditing ? 'Modifier' : 'Soumettre' }}
                  </button>
                  <button type="button" class="cancel-button" (click)="toggleForm()">
                    Annuler
                  </button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>

    <app-right-sidebar></app-right-sidebar>
  </div>
</div>