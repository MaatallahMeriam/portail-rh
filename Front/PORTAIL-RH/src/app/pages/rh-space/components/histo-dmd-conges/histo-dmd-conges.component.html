<div class="collab-home">
  <app-header></app-header>

  <div class="main-content">
    <app-sidebar (sidebarStateChange)="onSidebarStateChange($event)"></app-sidebar>

    <div class="feed" [class.sidebar-collapsed]="isSidebarCollapsed">
      <div class="container">
        <div class="header">
          <h2 class="title">Historique Demandes Congés</h2>
        </div>

        <section class="history-section">
          <div class="search-bar">
            <input
              type="text"
              [(ngModel)]="searchQuery"
              (input)="filterDemandes()"
              placeholder="Rechercher par nom, congé ou statut..."
            />
          </div>

          <div class="history-content">
            <ngx-datatable
              class="material"
              [rows]="filteredDemandes"
              [columns]="columns"
              [columnMode]="ColumnMode.force"
              [headerHeight]="50"
              [footerHeight]="50"
              [rowHeight]="60"
              [scrollbarH]="false"
              [scrollbarV]="true"
            >
              <!-- Collaborateur Cell Template -->
              <ngx-datatable-column name="Collaborateur" prop="nom" [width]="100">
                <ng-template let-row="row" let-value="value" ngx-datatable-cell-template>
                  <div class="collaborateur-cell">
                    <img
                      [src]="getPhotoUrl(row.userId)"
                      alt="Profile Photo of {{ value }} {{ row.prenom }}"
                      class="profile-photo"
                    />
                    <span>{{ value }} {{ row.prenom }}</span>
                  </div>
                </ng-template>
              </ngx-datatable-column>

              <!-- Nom Congé Column -->
              <ngx-datatable-column name="Nom Congé" prop="congeNom" [width]="100">
                <ng-template let-value="value" ngx-datatable-cell-template>
                  <span>{{ value }}</span>
                </ng-template>
              </ngx-datatable-column>

              <!-- Date Début Column -->
              <ngx-datatable-column name="Date Début" prop="dateDebut" [width]="80">
                <ng-template let-value="value" ngx-datatable-cell-template>
                  <span>{{ formatDate(value) }}</span>
                </ng-template>
              </ngx-datatable-column>

              <!-- Date Fin Column -->
              <ngx-datatable-column name="Date Fin" prop="dateFin" [width]="80">
                <ng-template let-value="value" ngx-datatable-cell-template>
                  <span>{{ formatDate(value) }}</span>
                </ng-template>
              </ngx-datatable-column>

              <!-- Durée Cell Template -->
              <ngx-datatable-column name="Durée" prop="duree" [width]="100">
                <ng-template let-row="row" let-value="value" ngx-datatable-cell-template>
                  {{ value }} {{ row.unite }}
                </ng-template>
              </ngx-datatable-column>

              <!-- Statut Cell Template -->
              <ngx-datatable-column name="Statut" prop="statut" [width]="120">
                <ng-template let-value="value" ngx-datatable-cell-template>
                  <div class="status-container">
                    <span class="status-dot" [style.background-color]="getStatusColor(value)"></span>
                    <span class="status-badge" [ngClass]="getStatusClass(value)">
                      {{ value || 'Inconnu' | titlecase }}
                    </span>
                  </div>
                </ng-template>
              </ngx-datatable-column>

              <ngx-datatable-footer>
                <ng-template ngx-datatable-footer-template>
                  <div class="footer-total">
                    <span>{{ totalDemandes }} Demandes au total</span>
                  </div>
                </ng-template>
              </ngx-datatable-footer>
            </ngx-datatable>
          </div>
        </section>
      </div>
    </div>

    <app-right-sidebar></app-right-sidebar>
  </div>
</div>