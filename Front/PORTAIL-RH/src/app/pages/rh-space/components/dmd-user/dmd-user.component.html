<div class="collab-home">
  <app-header></app-header>

  <div class="main-content">
    <app-sidebar (sidebarStateChange)="onSidebarStateChange($event)"></app-sidebar>

    <div class="feed" [class.sidebar-collapsed]="isSidebarCollapsed">
      <div class="container">
        <div class="header">
          <h2>Liste des Demandes de {{ user ? user.nom + ' ' + user.prenom : 'Utilisateur' }} :</h2>
        </div>

        <div class="filter-section">
          <div class="filter-group">
            <label for="typeFilter">Type de Demande :</label>
            <select id="typeFilter" [(ngModel)]="typeFilter" (change)="applyFilters()">
              <option *ngFor="let option of typeOptions" [value]="option">{{ option }}</option>
            </select>
          </div>
          <div class="filter-group">
            <label for="statutFilter">Statut :</label>
            <select id="statutFilter" [(ngModel)]="statutFilter" (change)="applyFilters()">
              <option *ngFor="let option of statutOptions" [value]="option">{{ option }}</option>
            </select>
          </div>
          <button class="reset-btn" (click)="resetFilters()">Réinitialiser</button>
        </div>

        <div class="history">
          <div class="history-table-container">
            <ngx-datatable
              class="material"
              [rows]="filteredDemandes"
              [columns]="columns"
              [columnMode]="'force'"
              [headerHeight]="50"
              [footerHeight]="50"
              [rowHeight]="60"
              [scrollbarH]="false"
              [scrollbarV]="true"
              [messages]="{
                emptyMessage: 'Aucune demande trouvée',
                totalMessage: 'demandes au total'
              }"
            >
              <ngx-datatable-column name="Collaborateur" [width]="200">
                <ng-template let-row="row" ngx-datatable-cell-template>
                  <div class="collaborateur-cell">
                    <img
                      [src]="getNormalizedImage(row.userPhoto)"
                      alt="Photo de {{ row.userFullName }}"
                      class="profile-photo"
                    />
                    <span>{{ row.userFullName }}</span>
                  </div>
                </ng-template>
              </ngx-datatable-column>

              <ngx-datatable-column prop="type" name="Type de Demande" [width]="150">
                <ng-template let-value="value" ngx-datatable-cell-template>
                  <span>{{ value }}</span>
                </ng-template>
              </ngx-datatable-column>

              <ngx-datatable-column prop="dateEmission" name="Date d'Émission" [width]="150">
                <ng-template let-value="value" ngx-datatable-cell-template>
                  <span>{{ value | date:'dd/MM/yyyy' }}</span>
                </ng-template>
              </ngx-datatable-column>

              <ngx-datatable-column name="Statut" prop="statut" [width]="150">
                <ng-template let-value="value" ngx-datatable-cell-template>
                  <span [ngClass]="{
                    'status-validated': value === 'VALIDEE',
                    'status-refused': value === 'REFUSEE',
                    'status-pending': value === 'EN_ATTENTE'
                  }">
                    {{ value }}
                  </span>
                </ng-template>
              </ngx-datatable-column>

              <ngx-datatable-footer>
                <ng-template ngx-datatable-footer-template>
                  <div class="footer-total">
                    <span>{{ totalDemandes }} demandes au total</span>
                  </div>
                </ng-template>
              </ngx-datatable-footer>
            </ngx-datatable>
          </div>
        </div>
      </div>
    </div>

    <app-right-sidebar></app-right-sidebar>
  </div>
</div>